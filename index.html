<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ewastetrack — Encontre pontos de reciclagem</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>

  <style>
    body {
     background: linear-gradient(135deg, #9D4EDD, #5A189A); 
      font-family: 'Verdana', sans-serif;
      color: #f8f9fa;
      margin: 0;
    }

    nav.navbar {
      background: #5A189A;
    }
    nav.navbar .navbar-brand, nav.navbar .nav-link {
      color: #fff;
    }
    #map {
      width: 90%;
      max-width: 900px;
      height: 400px;
      border: 2px solid #ccc;
      border-radius: 8px;
      margin: 20px auto;
    }
    @media (max-width: 600px) {
      #map {
        height: 300px;
      }
    }
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: linear-gradient(135deg, #9D4EDD, #5A189A); 
      color: #f8f9fa;
      text-align: center;
      padding: 8px 0;        
      font-size: 1rem;     
      box-shadow: 0 -1px 5px rgba(0,0,0,0.3); 
      z-index: 1000;
      backdrop-filter: blur(5px); 
    }
    .btn-eco {
      background-color: #5A189A;
      color: white;
      border: none;
    }
    .btn-eco:hover {
      background-color: #7b31c8;
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="assets/logo.png" alt="ECOcharge" width="40" class="me-2">
      Ewastetrack
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="menu">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a href="index.html" class="nav-link">Início</a></li>
        <li class="nav-item"><a href="pages/sobre.html" class="nav-link">Sobre</a></li>
        <li class="nav-item"><a href="pages/serviço.html" class="nav-link">Serviços</a></li>
        <li class="nav-item"><a href="pages/contato.html" class="nav-link">Contato</a></li>
        <li class="nav-item"><a href="pages/chatbot.html" class="nav-link">Chatbot</a></li>
      </ul>
    </div>
  </div>
</nav>

<section class="hero text-center mt-5">
  <div class="container">
    <h1 class="display-5 fw-bold">Encontre pontos de descarte de baterias perto de você</h1>
    <p class="lead">Digite seu CEP e localize o ponto de reciclagem mais próximo.</p>

    <div class="d-flex justify-content-center mt-4">
      <input type="text" id="cepInput" class="form-control w-50 me-2" placeholder="Digite o CEP (ex: 01001-000)">
      <button id="buscarCepBtn" class="btn btn-eco">Encontrar</button>
    </div>
  </div>
</section>

<section class="container my-5">
  <h2 class="mb-3 text-center">Mapa de pontos de coleta</h2>
  <div id="map"></div>
</section>

<footer>
  <small>© Ewastetrack</small>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script>
  var map = L.map('map').setView([-23.5505, -46.6333], 12); 

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  var pontos = [
    {nome: "Ponto de Coleta - Shopping Iguatemi (Sorocaba)", lat: -23.5017, lng: -47.4559},
    {nome: "Ponto de Coleta - Terminal Santo Antônio (Sorocaba)", lat: -23.5005, lng: -47.4523},
    {nome: "Ponto de Coleta - Praça de Eventos Votorantim", lat: -23.5445, lng: -47.4458},
    {nome: "Ponto de Coleta - Av. Paulista (SP)", lat: -23.5614, lng: -46.6559},
    {nome: "Ponto de Coleta - Parque Ibirapuera (SP)", lat: -23.5874, lng: -46.6576},
    {nome: "Ponto de Coleta - Shopping Aricanduva (SP)", lat: -23.5631, lng: -46.4983}
  ];

  pontos.forEach(p => {
    L.marker([p.lat, p.lng]).addTo(map).bindPopup(p.nome);
  });

  function calcularDistancia(lat1, lon1, lat2, lon2) {
    var R = 6371; // km
    var dLat = (lat2 - lat1) * Math.PI / 180;
    var dLon = (lon2 - lon1) * Math.PI / 180;
    var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon/2) * Math.sin(dLon/2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
  }

  document.getElementById('buscarCepBtn').addEventListener('click', function() {
    var cep = document.getElementById('cepInput').value.trim();
    if (cep === "") {
      alert("Por favor, digite um CEP válido.");
      return;
    }

   
    fetch(`https://viacep.com.br/ws/${cep.replace(/\D/g, '')}/json/`)
      .then(response => response.json())
      .then(data => {
        if (data.erro) {
          alert("CEP não encontrado.");
          return;
        }

        
        var endereco = `${data.logradouro}, ${data.bairro}, ${data.localidade}, ${data.uf}, Brasil`;

        fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(endereco)}`)
          .then(resp => resp.json())
          .then(locations => {
            if (locations.length === 0) {
              alert("Não foi possível localizar as coordenadas do endereço.");
              return;
            }

            var lat = parseFloat(locations[0].lat);
            var lon = parseFloat(locations[0].lon);

            
            map.setView([lat, lon], 14);

            
            if (window.userMarker) map.removeLayer(window.userMarker);
            if (window.closestMarker) map.removeLayer(window.closestMarker);
            if (window.circle) map.removeLayer(window.circle);
            if (window.line) map.removeLayer(window.line);

            
            window.userMarker = L.marker([lat, lon]).addTo(map).bindPopup("Localização do CEP").openPopup();

           
            var menorDist = Infinity;
            var pontoMaisProximo = null;

            pontos.forEach(p => {
              var dist = calcularDistancia(lat, lon, p.lat, p.lng);
              if (dist < menorDist) {
                menorDist = dist;
                pontoMaisProximo = p;
              }
            });

            if (pontoMaisProximo) {
              window.closestMarker = L.marker([pontoMaisProximo.lat, pontoMaisProximo.lng])
                .addTo(map)
                .bindPopup(`<b>${pontoMaisProximo.nome}</b><br>Distância: ${menorDist.toFixed(2)} km`)
                .openPopup();

              window.circle = L.circle([pontoMaisProximo.lat, pontoMaisProximo.lng], {
                radius: 200,
                color: 'green'
              }).addTo(map);

              window.line = L.polyline([[lat, lon], [pontoMaisProximo.lat, pontoMaisProximo.lng]], {
                color: 'blue',
                weight: 2,
                opacity: 0.7
              }).addTo(map);
            }
          })
          .catch(() => alert("Erro ao buscar coordenadas do endereço."));
      })
      .catch(() => alert("Erro ao buscar o CEP."));
  });
</script>

</body>
</html>
